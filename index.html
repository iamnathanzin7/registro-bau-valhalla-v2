<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro do Baú - Valhalla Corp</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Mantenha todos os estilos anteriores */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #1abc9c;
            --dark: #1a252f;
            --light: #ecf0f1;
            --success: #2ecc71;
            --warning: #e74c3c;
        }

        body {
            background: linear-gradient(135deg, #1a2a3a, #2c3e50);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: rgba(26, 37, 47, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* ... (mantenha todo o restante do estilo) ... */
    </style>
    <!-- Firebase SDK (versão compatível) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-archive"></i>
                <div>
                    <h1>Registro do Baú</h1>
                    <div class="subtitle">Valhalla Corporation - Controle de Itens</div>
                </div>
            </div>
        </header>
        
        <div class="form-container">
            <div class="form-grid">
                <div class="input-group">
                    <i class="fas fa-user"></i>
                    <input type="text" id="nome" placeholder="Seu nome">
                </div>
                
                <div class="input-group">
                    <i class="fas fa-exchange-alt"></i>
                    <select id="tipo">
                        <option value="" disabled selected>Selecione a ação</option>
                        <option value="colocou">Colocar no baú</option>
                        <option value="retirou">Retirar do baú</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <i class="fas fa-box"></i>
                    <input type="text" id="item" placeholder="Item (ex: AR-15, Colete)">
                </div>
                
                <div class="input-group">
                    <i class="fas fa-hashtag"></i>
                    <input type="number" id="quantidade" placeholder="Quantidade" min="1">
                </div>
            </div>
            
            <button class="btn" onclick="registrar()">
                <i class="fas fa-plus-circle"></i> Registrar Ação
            </button>
        </div>
        
        <div class="registros-container">
            <div class="registros-header">
                <h2><i class="fas fa-history"></i> Histórico de Movimentações</h2>
                <div class="total-registros" id="totalRegistros">0 registros</div>
            </div>
            
            <div class="registros-list" id="listaRegistros">
                <!-- Os registros serão carregados aqui -->
            </div>
        </div>
    </div>

    <script>
        // Sua configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAkYkBEAsN9NPU5ur7J4wtUzN0hesfA-tg",
            authDomain: "valhalla-corporation.firebaseapp.com",
            databaseURL: "https://valhalla-corporation-default-rtdb.firebaseio.com",
            projectId: "valhalla-corporation",
            storageBucket: "valhalla-corporation.firebasestorage.app",
            messagingSenderId: "10075239665",
            appId: "1:10075239665:web:4ad4695e51bad682df6550"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Referência ao nó de registros no Firebase
        const registrosRef = database.ref("registros-bau");
        
        function registrar() {
            const nome = document.getElementById("nome").value.trim();
            const tipo = document.getElementById("tipo").value;
            const item = document.getElementById("item").value.trim();
            const quantidade = document.getElementById("quantidade").value;
            
            if (!nome || !tipo || !item || !quantidade) {
                alert("Por favor, preencha todos os campos!");
                return;
            }
            
            if (parseInt(quantidade) <= 0) {
                alert("A quantidade deve ser maior que zero!");
                return;
            }
            
            // Criar objeto de registro
            const registro = {
                nome,
                tipo,
                item,
                quantidade,
                data: new Date().toLocaleString('pt-BR'),
                timestamp: firebase.database.ServerValue.TIMESTAMP
            };
            
            // Salvar no Firebase
            registrosRef.push(registro);
            
            // Limpar campos
            document.getElementById("item").value = "";
            document.getElementById("quantidade").value = "";
            document.getElementById("tipo").selectedIndex = 0;
            
            // Feedback visual
            const btn = document.querySelector('.btn');
            btn.innerHTML = '<i class="fas fa-check"></i> Registrado com Sucesso!';
            btn.style.background = 'linear-gradient(to right, #2ecc71, #27ae60)';
            
            setTimeout(() => {
                btn.innerHTML = '<i class="fas fa-plus-circle"></i> Registrar Ação';
                btn.style.background = 'linear-gradient(to right, var(--accent), var(--secondary))';
            }, 2000);
        }
        
        // Função para adicionar registro na lista
        function adicionarRegistro(registro, key) {
            const lista = document.getElementById("listaRegistros");
            
            const registroDiv = document.createElement('div');
            registroDiv.className = `registro ${registro.tipo === 'retirou' ? 'retirou' : ''}`;
            registroDiv.dataset.key = key;
            
            registroDiv.innerHTML = `
                <div class="registro-content">
                    <div class="registro-header">
                        <div class="action-icon">
                            <i class="fas ${registro.tipo === 'colocou' ? 'fa-plus' : 'fa-minus'}"></i>
                        </div>
                        <strong>${registro.nome}</strong>
                    </div>
                    <div class="item-info">
                        <span>${registro.quantidade}x ${registro.item}</span>
                    </div>
                </div>
                <div class="registro-time">
                    ${registro.data}
                </div>
            `;
            
            // Adicionar no topo da lista
            lista.insertBefore(registroDiv, lista.firstChild);
            
            // Atualizar contador
            const totalElement = document.getElementById("totalRegistros");
            const total = document.querySelectorAll('.registro').length;
            totalElement.textContent = `${total} ${total === 1 ? 'registro' : 'registros'}`;
        }
        
        // Ouvinte para novos registros
        registrosRef.orderByChild('timestamp').on('child_added', (snapshot) => {
            const registro = snapshot.val();
            adicionarRegistro(registro, snapshot.key);
        });
        
        // Ouvinte para registros removidos (se necessário)
        registrosRef.on('child_removed', (snapshot) => {
            const key = snapshot.key;
            const registroEl = document.querySelector(`.registro[data-key="${key}"]`);
            if (registroEl) {
                registroEl.remove();
                
                // Atualizar contador
                const totalElement = document.getElementById("totalRegistros");
                const total = document.querySelectorAll('.registro').length;
                totalElement.textContent = `${total} ${total === 1 ? 'registro' : 'registros'}`;
            }
        });
        
        // Carregar registros existentes ao iniciar
        window.onload = function() {
            registrosRef.once('value', (snapshot) => {
                const dados = snapshot.val();
                if (dados) {
                    // Converter objeto em array e ordenar por timestamp
                    const registrosArray = Object.entries(dados)
                        .map(([key, value]) => ({ key, ...value }))
                        .sort((a, b) => b.timestamp - a.timestamp);
                    
                    registrosArray.forEach(reg => {
                        adicionarRegistro(reg, reg.key);
                    });
                }
            });
        };
    </script>
</body>
</html>
